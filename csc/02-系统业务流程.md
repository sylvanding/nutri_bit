# 福宝智能营养健康管理系统 - 系统业务流程

## 一、系统总体业务流程

### 1.1 系统核心业务流程图

```mermaid
flowchart TB
    Start([用户启动系统]) --> CheckUser{是否已登录?}
    
    CheckUser -->|否| Register[用户注册/登录]
    CheckUser -->|是| CheckProfile{是否完善档案?}
    
    Register --> CreateProfile[创建健康档案]
    CreateProfile --> SetGoal[设置健康目标]
    SetGoal --> CalcTarget[计算营养目标]
    
    CheckProfile -->|否| CreateProfile
    CheckProfile -->|是| MainFunc[进入主功能区]
    CalcTarget --> MainFunc
    
    MainFunc --> FuncChoice{选择功能}
    
    FuncChoice -->|营养记录| RecordMeal[记录餐食]
    FuncChoice -->|数据分析| ViewAnalysis[查看营养分析]
    FuncChoice -->|智能推荐| GetRecommend[获取推荐]
    FuncChoice -->|社区互动| Community[社区功能]
    FuncChoice -->|会员服务| Membership[会员中心]
    FuncChoice -->|商城服务| Mall[商城购物]
    
    RecordMeal --> RecordType{记录方式}
    RecordType -->|拍照| PhotoRec[拍照识别]
    RecordType -->|语音| VoiceRec[语音识别]
    RecordType -->|手动| ManualRec[手动输入]
    
    PhotoRec --> AIRecognition[AI图像识别]
    VoiceRec --> AIVoice[语音转文本]
    AIVoice --> AIRecognition
    
    AIRecognition --> FoodList[生成菜品列表]
    FoodList --> UserAdjust[用户微调]
    UserAdjust --> CalcNutrition[计算营养数据]
    ManualRec --> CalcNutrition
    
    CalcNutrition --> SaveRecord[保存记录]
    SaveRecord --> ShowReport[生成营养报告]
    ShowReport --> GameReward[游戏化奖励]
    GameReward --> MainFunc
    
    ViewAnalysis --> AnalysisType{分析类型}
    AnalysisType -->|即时分析| InstantAnalysis[单餐分析]
    AnalysisType -->|每日报告| DailyReport[每日营养报告]
    AnalysisType -->|趋势分析| TrendAnalysis[周月趋势]
    AnalysisType -->|目标对比| GoalCompare[目标达成度]
    
    InstantAnalysis --> MainFunc
    DailyReport --> MainFunc
    TrendAnalysis --> MainFunc
    GoalCompare --> MainFunc
    
    GetRecommend --> RecommendType{推荐类型}
    RecommendType -->|菜品推荐| FoodRecommend[基于缺口推荐]
    RecommendType -->|配餐方案| MealPlan[智能配餐]
    RecommendType -->|营养建议| NutriAdvice[营养补充建议]
    
    FoodRecommend --> MainFunc
    MealPlan --> MainFunc
    NutriAdvice --> MainFunc
    
    Community --> SocialFunc{社交功能}
    SocialFunc -->|发布内容| PostContent[发布晒餐/菜谱]
    SocialFunc -->|浏览互动| Browse[浏览点赞评论]
    SocialFunc -->|一键跟吃| FollowEat[KOL菜谱购买]
    
    PostContent --> MainFunc
    Browse --> MainFunc
    FollowEat --> OrderProcess[订单流程]
    OrderProcess --> MainFunc
    
    Membership --> MemberFunc{会员功能}
    MemberFunc -->|查看权益| ViewBenefit[查看会员权益]
    MemberFunc -->|升级会员| Upgrade[升级购买]
    MemberFunc -->|使用特权| UsePremium[使用高级功能]
    
    ViewBenefit --> MainFunc
    Upgrade --> Payment[支付流程]
    Payment --> MainFunc
    UsePremium --> MainFunc
    
    Mall --> MallFunc{商城功能}
    MallFunc -->|净菜配送| FreshFood[购买净菜]
    MallFunc -->|健康食品| HealthFood[购买食品]
    MallFunc -->|营养计划| NutriPlan[购买计划]
    MallFunc -->|营养师服务| NutriConsult[预约咨询]
    
    FreshFood --> OrderProcess
    HealthFood --> OrderProcess
    NutriPlan --> OrderProcess
    NutriConsult --> OrderProcess
```

## 二、核心业务流程详解

### 2.1 用户注册与档案创建流程

```mermaid
flowchart TD
    A[用户首次使用] --> B[选择注册方式]
    
    B --> C1[邮箱注册]
    B --> C2[手机号注册]
    B --> C3[第三方登录]
    
    C1 --> D1[输入邮箱密码]
    C2 --> D2[输入手机号]
    C3 --> D3[授权第三方]
    
    D1 --> E1[发送验证邮件]
    D2 --> E2[发送验证码]
    D3 --> E3[获取用户信息]
    
    E1 --> F1[验证邮件]
    E2 --> F2[验证验证码]
    E3 --> G
    
    F1 --> G[注册成功]
    F2 --> G
    
    G --> H[引导创建健康档案]
    
    H --> I[输入基础信息]
    I --> I1[姓名]
    I --> I2[年龄]
    I --> I3[性别]
    I --> I4[身高]
    I --> I5[体重]
    I --> I6[活动水平]
    
    I1 & I2 & I3 & I4 & I5 & I6 --> J[设置健康目标]
    
    J --> J1{目标类型}
    J1 -->|减脂| K1[减脂目标]
    J1 -->|增肌| K2[增肌目标]
    J1 -->|维持| K3[维持健康]
    J1 -->|特殊营养| K4[特殊营养需求]
    
    K1 & K2 & K3 & K4 --> L[慢性病信息选填]
    
    L --> M[计算个性化营养目标]
    
    M --> M1[计算BMR基础代谢率]
    M --> M2[计算每日热量需求]
    M --> M3[计算宏量营养素分配]
    
    M1 & M2 & M3 --> N[生成个人健康档案]
    
    N --> O[展示欢迎页面]
    O --> P[进入主界面]
```

### 2.2 AI拍照识别与营养记录流程

```mermaid
flowchart TD
    A[用户点击拍照记录] --> B{会员权限检查}
    
    B -->|免费用户超限| C[提示升级会员]
    C --> D{用户选择}
    D -->|升级| E[跳转会员购买]
    D -->|取消| Z[返回]
    
    B -->|有权限| F[打开相机/相册]
    E --> F
    
    F --> G[选择/拍摄照片]
    G --> H[选择餐次类型]
    H --> H1[早餐]
    H --> H2[午餐]
    H --> H3[晚餐]
    H --> H4[加餐]
    
    H1 & H2 & H3 & H4 --> I[上传图片到服务器]
    
    I --> J[显示识别中...]
    J --> K[AI图像识别处理]
    
    K --> K1[调用VLM模型]
    K1 --> K2[解析图片内容]
    K2 --> K3[识别菜品名称]
    K3 --> K4[分解菜品原料]
    K4 --> K5[匹配营养数据库]
    K5 --> K6[汇总营养信息]
    
    K6 --> L[返回识别结果]
    L --> M[展示菜品列表]
    
    M --> N{用户操作}
    N -->|确认| O[进入微调环节]
    N -->|修正| P[手动修正菜品]
    N -->|删除| Q[删除错误菜品]
    N -->|添加| R[手动添加菜品]
    
    P --> M
    Q --> M
    R --> M
    
    O --> S[智能微调界面]
    
    S --> T[场景选择]
    T --> T1[家常菜]
    T --> T2[餐厅/外卖]
    T --> T3[食堂]
    
    T1 & T2 & T3 --> U[口味调整]
    U --> U1[清淡]
    U --> U2[适中]
    U --> U3[重口味]
    
    U1 & U2 & U3 --> V[份量估算]
    V --> V1[小份约1拳]
    V --> V2[中份约2拳]
    V --> V3[大份]
    
    V1 & V2 & V3 --> W[根据微调重新计算营养]
    
    W --> X[生成最终营养数据]
    X --> Y[保存营养记录]
    
    Y --> AA[并行处理]
    AA --> AB[生成营养报告]
    AA --> AC[更新每日统计]
    AA --> AD[触发游戏化奖励]
    AA --> AE[检查成就解锁]
    
    AB & AC & AD & AE --> AF[展示记录结果]
    
    AF --> AG[显示营养分析]
    AG --> AH[显示获得经验值]
    AH --> AI[显示连续打卡]
    AI --> AJ{是否解锁成就?}
    
    AJ -->|是| AK[弹出成就通知]
    AJ -->|否| AL[完成记录]
    AK --> AL
    
    AL --> AM[返回主界面]
```

### 2.3 营养分析与报告生成流程

```mermaid
flowchart TD
    A[用户查看营养分析] --> B{分析类型选择}
    
    B -->|单餐分析| C[单餐营养报告]
    B -->|每日汇总| D[每日营养报告]
    B -->|周月趋势| E[趋势分析报告]
    B -->|目标对比| F[目标达成报告]
    
    C --> C1[查询单餐记录]
    C1 --> C2[提取营养数据]
    C2 --> C3[计算营养成分占比]
    C3 --> C4[生成营养评分]
    C4 --> C5[展示单餐报告]
    
    D --> D1[查询当日所有记录]
    D1 --> D2[汇总各餐营养数据]
    D2 --> D3[计算总热量摄入]
    D3 --> D4[计算三大营养素]
    D4 --> D5[与目标值对比]
    D5 --> D6[生成营养评分]
    D6 --> D7[生成改善建议]
    D7 --> D8{会员等级检查}
    
    D8 -->|VIP/会员| D9[生成详细报告]
    D8 -->|免费用户| D10[生成基础报告]
    
    D9 --> D11[包含微量元素分析]
    D11 --> D12[包含趋势预测]
    D12 --> D13[包含个性化建议]
    D13 --> D14[展示详细报告]
    
    D10 --> D15[展示基础报告]
    
    E --> E1[查询时间段记录]
    E1 --> E2{时间范围}
    E2 -->|周报告| E3[查询近7天数据]
    E2 -->|月报告| E4[查询近30天数据]
    
    E3 & E4 --> E5[统计每日营养数据]
    E5 --> E6[计算平均值和波动]
    E6 --> E7[绘制趋势图表]
    E7 --> E8[分析饮食模式]
    E8 --> E9[生成趋势报告]
    E9 --> E10{会员权限检查}
    
    E10 -->|有权限| E11[展示完整趋势分析]
    E10 -->|无权限| E12[提示升级查看]
    
    F --> F1[获取用户营养目标]
    F1 --> F2[查询实际摄入数据]
    F2 --> F3[计算目标达成率]
    F3 --> F4[热量达成率]
    F3 --> F5[蛋白质达成率]
    F3 --> F6[碳水达成率]
    F3 --> F7[脂肪达成率]
    
    F4 & F5 & F6 & F7 --> F8[生成达成度图表]
    F8 --> F9[分析偏差原因]
    F9 --> F10[生成调整建议]
    F10 --> F11[展示对比报告]
    
    C5 & D14 & D15 & E11 & E12 & F11 --> G[用户查看报告]
    
    G --> H{用户操作}
    H -->|分享| I[分享到社区]
    H -->|保存| J[保存报告]
    H -->|导出| K[导出PDF]
    H -->|返回| L[返回主界面]
    
    I --> L
    J --> L
    K --> L
```

### 2.4 智能推荐与配餐流程

```mermaid
flowchart TD
    A[用户请求推荐] --> B[获取用户健康档案]
    B --> C[分析用户饮食历史]
    C --> D[计算营养缺口]
    
    D --> E{推荐类型}
    
    E -->|菜品推荐| F[菜品推荐流程]
    E -->|智能配餐| G[配餐方案流程]
    E -->|营养建议| H[营养建议流程]
    
    F --> F1[分析当前营养缺口]
    F1 --> F2[缺少蛋白质?]
    F1 --> F3[缺少纤维?]
    F1 --> F4[缺少维生素?]
    F1 --> F5[热量超标?]
    
    F2 & F3 & F4 & F5 --> F6[查询菜品数据库]
    F6 --> F7[匹配补充性菜品]
    F7 --> F8[过滤用户禁忌]
    F8 --> F9[考虑用户偏好]
    F9 --> F10[排序推荐列表]
    F10 --> F11[生成推荐理由]
    F11 --> F12[展示推荐菜品]
    
    G --> G1{会员权限检查}
    G1 -->|无权限| G2[提示升级会员]
    G1 -->|有权限| G3[计算剩余热量]
    
    G2 --> END1[返回]
    
    G3 --> G4[计算剩余营养素]
    G4 --> G5{配餐类型}
    
    G5 -->|单餐配餐| G6[生成单餐方案]
    G5 -->|全天配餐| G7[生成全天方案]
    
    G6 --> G8[查询菜品组合]
    G8 --> G9[优化营养平衡]
    G9 --> G10[控制总热量]
    G10 --> G11[考虑口味搭配]
    G11 --> G12[生成配餐方案]
    
    G7 --> G13[分配三餐热量]
    G13 --> G14[早餐30%]
    G13 --> G15[午餐40%]
    G13 --> G16[晚餐30%]
    
    G14 --> G17[生成早餐方案]
    G15 --> G18[生成午餐方案]
    G16 --> G19[生成晚餐方案]
    
    G17 & G18 & G19 --> G20[整体优化调整]
    G20 --> G21[确保营养达标]
    G21 --> G22[展示配餐方案]
    
    G12 --> G23[展示方案详情]
    G22 --> G23
    
    G23 --> G24{用户操作}
    G24 -->|一键采用| G25[保存为今日计划]
    G24 -->|调整方案| G26[修改部分菜品]
    G24 -->|查看详情| G27[查看菜品详情]
    G24 -->|购买食材| G28[跳转商城购买]
    
    G25 --> END2[完成]
    G26 --> G3
    G27 --> G23
    G28 --> G29[净菜配送流程]
    
    H --> H1[分析营养状态]
    H1 --> H2[检测营养素缺乏]
    H2 --> H3[分析健康风险]
    H3 --> H4[考虑慢性病情况]
    H4 --> H5[生成个性化建议]
    
    H5 --> H6[饮食结构建议]
    H5 --> H7[营养补充建议]
    H5 --> H8[生活方式建议]
    H5 --> H9[注意事项提醒]
    
    H6 & H7 & H8 & H9 --> H10[展示营养建议]
    H10 --> H11{用户操作}
    
    H11 -->|采纳建议| H12[标记已读]
    H11 -->|咨询营养师| H13[跳转营养师服务]
    H11 -->|分享| H14[分享到社区]
    
    F12 & END2 & H12 & H13 & H14 --> END3[返回主界面]
```

### 2.5 社区互动与一键跟吃流程

```mermaid
flowchart TD
    A[用户进入社区] --> B{功能选择}
    
    B -->|发布内容| C[发布流程]
    B -->|浏览互动| D[浏览流程]
    B -->|一键跟吃| E[跟吃流程]
    
    C --> C1{内容类型}
    C1 -->|晒餐| C2[选择餐食记录]
    C1 -->|菜谱| C3[创建菜谱]
    C1 -->|经验| C4[撰写文章]
    
    C2 --> C5[添加照片]
    C3 --> C6[填写菜谱信息]
    C4 --> C7[编辑内容]
    
    C5 & C6 & C7 --> C8[添加描述文字]
    C8 --> C9[添加标签]
    C9 --> C10[选择可见范围]
    C10 --> C11{是否关联营养数据}
    
    C11 -->|是| C12[附加营养信息]
    C11 -->|否| C13[发布内容]
    C12 --> C13
    
    C13 --> C14[内容审核]
    C14 --> C15{审核结果}
    
    C15 -->|通过| C16[发布成功]
    C15 -->|不通过| C17[返回修改]
    
    C16 --> C18[通知关注者]
    C18 --> C19[游戏化奖励]
    C19 --> Z1[返回社区]
    
    D --> D1[展示内容流]
    D1 --> D2{内容来源}
    
    D2 -->|关注| D3[关注用户动态]
    D2 -->|推荐| D4[智能推荐内容]
    D2 -->|热门| D5[热门内容]
    D2 -->|话题| D6[话题讨论区]
    
    D3 & D4 & D5 & D6 --> D7[展示内容列表]
    D7 --> D8[用户浏览内容]
    D8 --> D9{用户操作}
    
    D9 -->|点赞| D10[点赞]
    D9 -->|评论| D11[发表评论]
    D9 -->|收藏| D12[收藏内容]
    D9 -->|分享| D13[分享转发]
    D9 -->|关注| D14[关注作者]
    D9 -->|举报| D15[举报内容]
    
    D10 & D11 & D12 & D13 & D14 & D15 --> D16[更新互动数据]
    D16 --> D7
    
    E --> E1[浏览KOL内容]
    E1 --> E2[选择跟吃内容]
    E2 --> E3[查看菜品详情]
    
    E3 --> E4[展示营养信息]
    E4 --> E5[展示配送选项]
    
    E5 --> E6{配送类型}
    E6 -->|净菜包| E7[预处理食材+调料]
    E6 -->|半成品| E8[部分预制]
    E6 -->|成品外卖| E9[即食热食]
    
    E7 & E8 & E9 --> E10[选择份数]
    E10 --> E11[选择配送时间]
    E11 --> E12[确认收货地址]
    E12 --> E13[计算订单金额]
    
    E13 --> E14[展示订单详情]
    E14 --> E15{用户确认}
    
    E15 -->|取消| Z2[返回社区]
    E15 -->|确认| E16[选择支付方式]
    
    E16 --> E17{支付方式}
    E17 -->|微信| E18[微信支付]
    E17 -->|支付宝| E19[支付宝支付]
    E17 -->|余额| E20[账户余额]
    
    E18 & E19 & E20 --> E21[支付处理]
    E21 --> E22{支付结果}
    
    E22 -->|成功| E23[创建订单]
    E22 -->|失败| E24[支付失败提示]
    
    E24 --> E16
    
    E23 --> E25[通知中央厨房]
    E25 --> E26[准备配送]
    E26 --> E27[物流配送]
    E27 --> E28[用户收货]
    
    E28 --> E29[自动记录营养数据]
    E29 --> E30[同步到营养记录]
    E30 --> E31[生成营养报告]
    E31 --> E32[游戏化奖励]
    
    E32 --> E33{用户操作}
    E33 -->|评价| E34[评价订单]
    E33 -->|晒餐| E35[分享到社区]
    E33 -->|再次购买| E36[加入复购清单]
    
    E34 & E35 & E36 --> Z3[完成]
```

### 2.6 会员体系与权限管理流程

```mermaid
flowchart TD
    A[用户使用功能] --> B[权限检查]
    
    B --> C{获取用户会员等级}
    C -->|基础版| D[基础版权限]
    C -->|会员版| E[会员版权限]
    C -->|VIP版| F[VIP版权限]
    
    D --> D1[每月10次AI识别]
    D --> D2[基础营养记录]
    D --> D3[每日营养简报]
    D --> D4[社区互动]
    D --> D5[有广告显示]
    
    E --> E1[无限AI识别]
    E --> E2[高级数据报告]
    E --> E3[智能配餐建议]
    E --> E4[全部AI菜谱]
    E --> E5[无广告体验]
    E --> E6[AI伙伴卡卡]
    
    F --> F1[会员版全部功能]
    F --> F2[专属AI皮肤]
    F --> F3[高级语音包]
    F --> F4[营养师咨询]
    F --> F5[专属客服]
    F --> F6[高级微量元素分析]
    F --> F7[专属会员徽章]
    
    D1 & D2 & D3 & D4 & D5 --> G{使用高级功能?}
    E1 & E2 & E3 & E4 & E5 & E6 --> H[允许使用]
    F1 & F2 & F3 & F4 & F5 & F6 & F7 --> H
    
    G -->|是| I[权限不足]
    G -->|否| H
    
    I --> J[弹出升级提示]
    J --> K{用户选择}
    
    K -->|升级| L[打开会员中心]
    K -->|取消| M[返回]
    
    L --> N[展示会员方案]
    N --> O{选择会员类型}
    
    O -->|会员版| P[¥19.9/月]
    O -->|VIP版| Q[¥39.9/月]
    
    P --> R{选择订阅周期}
    Q --> R
    
    R -->|月付| S1[月度订阅]
    R -->|季付| S2[季度订阅-9折]
    R -->|年付| S3[年度订阅-8折]
    
    S1 & S2 & S3 --> T[计算订单金额]
    T --> U[展示订单详情]
    U --> V{确认购买?}
    
    V -->|取消| M
    V -->|确认| W[选择支付方式]
    
    W --> X{支付方式}
    X -->|微信| Y1[微信支付]
    X -->|支付宝| Y2[支付宝支付]
    X -->|Apple Pay| Y3[Apple Pay]
    
    Y1 & Y2 & Y3 --> Z[支付处理]
    Z --> AA{支付结果}
    
    AA -->|成功| AB[更新会员状态]
    AA -->|失败| AC[支付失败]
    
    AC --> W
    
    AB --> AD[更新权限数据]
    AD --> AE[重置使用配额]
    AE --> AF[发放会员礼包]
    AF --> AG[通知用户]
    AG --> AH[展示欢迎页面]
    AH --> AI[解锁高级功能]
    
    AI --> H
    
    H --> AJ[正常使用功能]
    
    AJ --> AK{需要计量的功能?}
    AK -->|是| AL[记录使用次数]
    AK -->|否| AM[直接使用]
    
    AL --> AN[更新使用配额]
    AN --> AO{配额检查}
    
    AO -->|已用完| AP[提示升级]
    AO -->|还有余额| AM
    
    AM --> AQ[功能执行成功]
    AQ --> AR[返回]
```

### 2.7 营养师咨询服务流程

```mermaid
flowchart TD
    A[用户请求营养师服务] --> B{会员权限检查}
    
    B -->|VIP会员| C[进入服务]
    B -->|非VIP| D[展示服务介绍]
    
    D --> E{用户选择}
    E -->|购买单次| F[单次咨询购买]
    E -->|升级VIP| G[升级VIP会员]
    E -->|返回| Z1[返回]
    
    F --> H[支付咨询费用]
    G --> I[会员购买流程]
    H --> C
    I --> C
    
    C --> J[浏览营养师列表]
    J --> K[查看营养师信息]
    
    K --> L[展示专业资质]
    L --> L1[教育背景]
    L --> L2[工作经验]
    L --> L3[专业领域]
    L --> L4[用户评价]
    L --> L5[咨询价格]
    
    L1 & L2 & L3 & L4 & L5 --> M{选择营养师}
    
    M -->|继续浏览| J
    M -->|选定| N[预约咨询]
    
    N --> O{咨询类型}
    O -->|视频咨询| P1[视频通话]
    O -->|语音咨询| P2[语音通话]
    O -->|文字咨询| P3[在线聊天]
    
    P1 & P2 & P3 --> Q[选择咨询时间]
    Q --> R[查看可预约时段]
    R --> S[选择具体时间]
    S --> T[填写咨询需求]
    
    T --> U[上传相关资料]
    U --> U1[饮食记录]
    U --> U2[体检报告]
    U --> U3[健康档案]
    
    U1 & U2 & U3 --> V[提交预约申请]
    V --> W[营养师确认]
    
    W --> X{确认结果}
    X -->|接受| Y[预约成功]
    X -->|拒绝| Z2[选择其他营养师]
    
    Z2 --> J
    
    Y --> AA[支付咨询费用]
    AA --> AB[添加到日程]
    AB --> AC[发送提醒通知]
    
    AC --> AD[等待咨询时间]
    AD --> AE[咨询时间到]
    
    AE --> AF{咨询类型}
    AF -->|视频/语音| AG[启动通话]
    AF -->|文字| AH[打开聊天室]
    
    AG --> AI[建立连接]
    AI --> AJ[开始咨询]
    
    AH --> AJ
    
    AJ --> AK[咨询进行中]
    AK --> AL[营养师分析问题]
    AL --> AM[提供专业建议]
    AM --> AN[解答用户疑问]
    AN --> AO[制定改善方案]
    
    AO --> AP[咨询记录保存]
    AP --> AQ[生成咨询报告]
    
    AQ --> AR[营养师处方]
    AR --> AR1[饮食建议]
    AR --> AR2[营养补充方案]
    AR --> AR3[生活方式建议]
    AR --> AR4[复诊计划]
    
    AR1 & AR2 & AR3 & AR4 --> AS[推送给用户]
    
    AS --> AT[用户查看方案]
    AT --> AU{用户操作}
    
    AU -->|采纳方案| AV[保存到健康档案]
    AU -->|购买产品| AW[跳转商城]
    AU -->|预约复诊| AX[预约下次咨询]
    AU -->|评价服务| AY[评价营养师]
    
    AV --> AZ[方案执行追踪]
    AZ --> BA[定期提醒]
    BA --> BB[执行情况反馈]
    BB --> BC[方案效果评估]
    
    AW --> BD[购买营养品/食材]
    AX --> N
    
    AY --> BE[提交评价]
    BE --> BF[评分和评论]
    BF --> BG[更新营养师评价]
    
    BC & BD & BG --> BH[完成服务]
```

## 三、支撑业务流程

### 3.1 游戏化奖励触发流程

```mermaid
flowchart TD
    A[用户行为触发] --> B{行为类型}
    
    B -->|记录餐食| C1[记录行为]
    B -->|连续打卡| C2[打卡行为]
    B -->|完成挑战| C3[挑战行为]
    B -->|社区互动| C4[社交行为]
    B -->|达成目标| C5[目标行为]
    
    C1 --> D1[计算经验值]
    C2 --> D2[更新连续天数]
    C3 --> D3[挑战完成奖励]
    C4 --> D4[社交互动奖励]
    C5 --> D5[目标达成奖励]
    
    D1 --> E[累加总经验值]
    D2 --> F[检查连续打卡]
    D3 --> E
    D4 --> E
    D5 --> E
    
    E --> G{是否升级?}
    G -->|是| H[等级提升]
    G -->|否| I[继续累积]
    
    H --> J[播放升级动画]
    J --> K[解锁新特权]
    K --> L[推送升级通知]
    
    F --> M{连续天数里程碑?}
    M -->|是| N[发放里程碑奖励]
    M -->|否| O[继续打卡]
    
    N --> P[3天/7天/30天奖励]
    
    C1 & C2 & C3 & C4 & C5 --> Q[检查成就条件]
    Q --> R{成就解锁?}
    
    R -->|是| S[解锁成就]
    R -->|否| T[更新成就进度]
    
    S --> U[播放解锁动画]
    U --> V[发放成就奖励]
    V --> W[推送成就通知]
    
    I & L & O & P & T & W --> X[更新用户游戏化数据]
    X --> Y[刷新界面显示]
```

### 3.2 数据同步与存储流程

```mermaid
flowchart TD
    A[用户操作产生数据] --> B{数据类型}
    
    B -->|用户档案| C1[档案数据]
    B -->|营养记录| C2[记录数据]
    B -->|社区内容| C3[内容数据]
    B -->|订单交易| C4[交易数据]
    B -->|游戏化数据| C5[游戏数据]
    
    C1 --> D1[验证数据格式]
    C2 --> D2[验证数据完整性]
    C3 --> D3[内容审核]
    C4 --> D4[订单验证]
    C5 --> D5[数据校验]
    
    D1 & D2 & D3 & D4 & D5 --> E[写入数据库]
    
    E --> F{存储类型}
    F -->|关系数据| G1[PostgreSQL]
    F -->|文档数据| G2[MongoDB]
    F -->|缓存数据| G3[Redis]
    F -->|文件数据| G4[对象存储]
    
    G1 --> H[主数据库写入]
    H --> I[从数据库同步]
    
    G2 --> J[文档存储]
    G3 --> K[缓存更新]
    G4 --> L[文件上传]
    
    I & J & K & L --> M[数据备份]
    M --> N[增量备份]
    M --> O[全量备份每日]
    
    N & O --> P[备份到云存储]
    
    E --> Q[实时同步]
    Q --> R{多端同步}
    
    R -->|移动端| S1[推送到移动端]
    R -->|Web端| S2[推送到Web端]
    R -->|微信小程序| S3[推送到小程序]
    
    S1 & S2 & S3 --> T[客户端更新]
    T --> U[刷新界面数据]
```

---

*文档版本：v1.0*  
*编制日期：2025年10月2日*  
*编制单位：福宝智能营养健康管理系统项目组*

